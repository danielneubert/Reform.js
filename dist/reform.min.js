"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"==typeof exports?a(jQuery):module.exports=a(require("jquery"))})(function(a){"use strict";var b=function b(c,d){_classCallCheck(this,b),this.defaults={ajax:{},convert:"serialize",debugMode:!1,lang:"en",localization:{en:{errorMinLength:"Please enter at lease 2 characters.",errorValidationUrl:"Web url not valid.",errorValidationEmail:"Email address not valid.",errorValidationPhone:"Phone number not valid."},de:{errorMinLength:"Bitte geben Sie mindestens 2 Zeichen an.",errorValidationUrl:"Web-URL nicht g\xFCltig.",errorValidationEmail:"E-Mail Adresse nicht g\xFCltig.",errorValidationPhone:"Telefonnummer nicht g\xFCltig."}},type:"post",url:null,validation:{minLength:2,displayRequireErrorInfo:!1,displayValidationErrorInfo:!0,submitOnRequireError:!1,submitOnValidationError:!1}},this.parent=c,this.$parent=a(c),this.successCounter=0,this.validationError=!1,this.$validationObject=null,this.options=a.extend({},this.defaults,d),this.init(!0)};b.prototype.ensureParam=function(a,b,c){return("undefined"==typeof a?"undefined":_typeof(a))===b?a:c},b.prototype.out=function(a,b,c){switch(b=this.ensureParam(b,"string",""),c=this.ensureParam(c,"boolean",!1),"string"==typeof a&&(a="[Reform] "+a),b){default:case"log":{(c||this.options.debugMode)&&console.log(a);break}case"warn":{(c||this.options.debugMode)&&console.warn(a);break}case"err":{console.error(a);break}}},b.prototype.outputError=function(b,c){c=this.ensureParam(c,"string",""),a(b).addClass("rf-error"),0<c.length&&a(b).append("<p class=\"rf-error-info\">"+c+"</p>")},b.prototype.getLabel=function(a){return a=this.ensureParam(a,"string",""),"object"===_typeof(this.options.localization[this.options.lang])?"string"==typeof this.options.localization[this.options.lang][a]?this.options.localization[this.options.lang][a]:(this.out("Can't find key '"+this.options.lang+"."+a+"'.","err"),"{{ "+a+" }}"):(this.out("Can't find localization '"+this.options.lang+"'.","err"),"{{ "+a+" }}")},b.prototype.callEvent=function(a,b){return this.out("Calling trigger-event 'rf-"+a+"'."),this.$parent.triggerHandler("rf-"+a,b)},b.prototype.validateString=function(a,b,c){switch(b=this.ensureParam(b,"string",""),c=this.ensureParam(c,"string",""),c){case"text":break;case"url":{var d=/^(http(s?)\:\/\/|~\/|\/)?([a-zA-Z]{1}([\w\-]+\.)+([\w]{2,7}))(:[\d]{1,5})?\/?(\w+\.[\w]{3,4})?((\?\w+=\w+)?(&\w+=\w+)*)?/;return d.test(b)}case"email":{var e=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(b)}case"phone":{var f=/^(((((((00|\+)[0-9][0-9]{1,2}[ \-/]?)|0)[1-9][0-9]{1,4})[ \-/]?)|((((00|\+)49\()|\(0)[1-9][0-9]{1,4}\)[ \-/]?))[0-9]{1,7}([ \-/]?[0-9]{1,5})?)$/;return f.test(b)}case"date":break;default:return this.callEvent("validate-custom",[b,c,a]);}},b.prototype.init=function(){var b=this.$parent.prop("outerHTML").split(">",1)[0]+">";if(!this.$parent.hasClass("rf-init")){this.$parent.addClass("rf-init"),a(".rf-send",this.parent).length||this.$parent.append("<button class=\"rf-send\">"+a("input[type=\"submit\"]",this.parent).val()+"</button>"),a(".rf-send",this.parent).show(),a("input[type=\"submit\"]",this.parent).hide();var c=this;a("button.rf-send",this.parent).click(function(a){return a.stopPropagation(),c.submit(),!1}),this.groupBehavior(),this.selectPlaceholder()}this.callEvent("initialize",[this.parent]),this.out("You are running Reform.js in development mode. We recomend to set 'debugMode' to 'false' when you use this script in production."),this.out("Successfully initialized Reform for "+b)},b.prototype.submit=function(){var a=this;!1!==this.callEvent("send-before",[a.parent])&&!1!==this.callEvent("validation-before",[a.parent])&&this.validate()},b.prototype.validate=function(){var b=this,c=0,d=!1;a(".rf-error",b.parent).removeClass("rf-error"),a(".rf-error-info",b.parent).remove(),a(".rf-group",b.parent).length?a(".rf-group",b.parent).each(function(){c++;var e=!1,f=this,g=a("label",this).length;a("label",this).length==a("label.rf-req",this).length?a("label",this).each(function(h){if(a("input",this).is(":checked"))return e=!0,b.out("Group has selected child. (true)"),a(".rf-group",b.parent).length!=c||(b.validateSingle(d),!0);if(g==h+1&&!e)if(d=!0,a("label",f).each(function(){b.outputError(this)}),b.out("Group has no selected child. (false)"),a(".rf-group",b.parent).length==c)b.validateSingle(d);else return!0}):0<a("label.rf-req",this).length?b.out("Group contains mixed labels (required and not required)."):b.out("Group does not contain any required fields.")}):b.validateSingle(d)},b.prototype.validateSingle=function(b){var c=this;a("label",c.parent).each(function(d){var e=!1;if(a(this).parents().each(function(){a(this).hasClass("rf-group")&&(e=!0)}),!e)if(a(this).hasClass("rf-req"))switch(!0){case a(this).hasClass("rf-checkbox")||a(this).hasClass("rf-radio"):{a("input",this).is(":checked")||(b=!0,c.out("Checkbox or radio did not pass validation:"),c.out(a(this)),c.outputError(this));break}case a("select",this).length:{"rf-placeholder"==a("select",this).val()&&(b=!0,c.out("Select did not pass validation:"),c.out(a(this)),c.outputError(this));break}default:{if(a("input, textarea",this).val().length<c.options.validation.minLength)b=!0,c.out("Input or textarea did not pass validation (minLength):"),c.out(a(this)),c.outputError(this);else if(a(this).hasClass("rf-val")){var f;f="string"==typeof a(this).attr("rf-val")&&1<a(this).attr("rf-val").length?a(this).attr("rf-val"):a("input",this).attr("type"),c.validateString(a(this),a("input",this).val(),f)||(b=!0,c.out("Input or textarea did not pass validation (validationType = '"+f+"'):"),c.out(a(this)),c.outputError(this,c.getLabel("errorValidation"+f.charAt(0).toUpperCase()+f.slice(1).toLowerCase())))}break}}else a("select",this).length&&"rf-placeholder"==a("select",this).val()&&(a("select",this).val(""),a("select",this).parent().addClass("rf-reselect"));a("label",c.parent).length==d+1&&(!1===c.callEvent("validation-after",[c.parent])&&(b=!1),b?c.out("Validation was not successfully."):(c.out("Validation passed successfully."),c.sendForm()))})},b.prototype.sendForm=function(){var b=this,c=this.ensureParam(b.$parent.attr("rf-url"),"string",void 0);c=this.ensureParam(c,"string",b.$parent.attr("action")),c=this.ensureParam(c,"string",b.options.url),c=this.ensureParam(c,"string",".");var d=this.ensureParam(b.$parent.attr("rf-type"),"string",void 0);d=this.ensureParam(d,"string",b.$parent.attr("method")),d=this.ensureParam(d,"string",b.options.type),d=this.ensureParam(d,"string","GET");var e={};switch(b.options.convert){case"serialize":{e=a("input, textarea, select",b.parent).serialize();break}case"json":{a("input, textarea, select",b.parent).each(function(){e[a(this).attr("name")]=a(this).val()});break}}var f={type:d,url:c,data:e};f=a.extend({},b.options.ajax,f);var g;a.ajax(f).done(function(a){g=a}).fail(function(){b.out("Submittion was not successfull.","err")}).always(function(){b.afterSendForm(g)})},b.prototype.afterSendForm=function(b){var c=this;a(".rf-select.rf-reselect",this.parent).each(function(){a(this).removeClass("rf-reselect"),a("select",this).val("rf-placeholder")}),this.callEvent("send-after",[c.parent,b])},b.prototype.groupBehavior=function(){this;a(".rf-group.rf-group-single",this.parent).each(function(){a("input",this).change(function(){var b=a(this).is(":checked");a(this).closest(".rf-group.rf-group-single").find("input").prop("checked",!1),b&&a(this).prop("checked",!0)})})},b.prototype.selectPlaceholder=function(){this;a(".rf-select",this.parent).each(function(){var b=a("select",this),c=b.attr("placeholder");"string"==typeof c&&0<c.length&&(b.prepend("<option value=\"rf-placeholder\">"+c+"</option>"),b.val("rf-placeholder"))})},a.fn.reform=function(){for(var a=this,c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=0;e<this.length;e++)if("object"===("undefined"==typeof c?"undefined":_typeof(c))||"undefined"==typeof c)a[e].reform=new b(a[e],c);else return a[e].reform[c].apply(a[e].reform,d);return a}});